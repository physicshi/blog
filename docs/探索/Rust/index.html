<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="我的秘密基地 Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="我的秘密基地 Blog Atom Feed"><title data-react-helmet="true">Rust | 我的秘密基地</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://physicshi.github.io/docs/探索/Rust"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Rust | 我的秘密基地"><meta data-react-helmet="true" name="description" content="Rust 是一门兼顾内存安全、高并发和稳定运行的编程语言。"><meta data-react-helmet="true" property="og:description" content="Rust 是一门兼顾内存安全、高并发和稳定运行的编程语言。"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://physicshi.github.io/docs/探索/Rust"><link data-react-helmet="true" rel="alternate" href="https://physicshi.github.io/docs/探索/Rust" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://physicshi.github.io/docs/探索/Rust" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.28eae8ec.css">
<link rel="preload" href="/assets/js/runtime~main.a7495c96.js" as="script">
<link rel="preload" href="/assets/js/main.c78f278f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_RZKW">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_RFGx themedImage--light_Ble8 navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_RFGx themedImage--dark_wwiP navbar__logo"><b class="navbar__title">秘密基地</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">笔记📒</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/physicshi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_mu0C"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_nWAW react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_MFxJ">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_MFxJ">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_IIrL"><button class="clean-btn backToTopButton_x+Rm" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_psz0"><div class="sidebar_aYCW"><nav class="menu thin-scrollbar menu_h+Ol menuWithAnnouncementBar_GKH3"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">写在前面</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">浏览器</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CSS</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">JavaScript</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Webpack</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Vite</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Babel</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">React</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">NodeJS</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">不只是前端</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">探索</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/探索/Rust">Rust</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/探索/Go">Go</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/探索/MySQL">MySQL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/探索/Nginx">Nginx</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/探索/Docker">Docker</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/探索/OS">OS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/探索/部署">部署</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/探索/CookieSessionToken">CookieSessionToken</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/探索/一些面试">一些面试</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">leetcode</a></li></ul></nav></div></aside><main class="docMainContainer_jMVY"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_+GTl"><div class="docItemContainer_RH7h"><article><div class="tocCollapsible_y1bX tocMobile_zI+Y"><button type="button" class="clean-btn tocCollapsibleButton_U+cm">On this page</button></div><div class="markdown"><header><h1>Rust</h1></header><p>Rust 是一门兼顾内存安全、高并发和稳定运行的编程语言。</p><p>从语言的内核来看，它重塑了我们对一些基本概念的理解。比如 Rust 清晰地定义了变量在一个作用域下的生命周期，让开发者在摒弃垃圾回收（GC）这样的内存和性能杀手的前提下，还能够无需关心手动内存管理，让内存安全和高性能二者兼得。</p><p>从语言的外观来看，它使用起来感觉很像 Python/TypeScript 这样的高级语言，表达能力一流，但性能丝毫不输于 C/C++，从而让表达力和高性能二者兼得。</p><blockquote><p>C++ 这种古老语言都是手动回收内存的<br>
Java、JavaScript 等语言都有专门的 GC 来回收内存<br>
Rust 则是通过编译器限制了堆上的对象只能被一个变量引用，多了就复制或者只是借用，然后变量在作用域销毁时回收对应的对象，也就是所有权机制<br></p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_jJj8" id="rust-的包管理工具"></a>rust 的包管理工具<a class="hash-link" href="#rust-的包管理工具" title="Direct link to heading">#</a></h2><p><strong>cargo 是类似于 npm 的存在。</strong></p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi shell"><pre tabindex="0" class="prism-code language-shell codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token plain">cargo init</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p><img src="/assets/images/rustcontent-ae733d01bf91ca3b59e8c4d7056df98f.png"></p><p><code>cargo.toml</code> 相当于 <code>package.json</code>，也是声明包信息和 <code>dependencies</code> 的。</p><blockquote><p>对比<code>npm init</code>后只有<code>package.json</code>，<code>rust</code>甚至还多了<code>src</code>并且初始化了<code>git</code></p></blockquote><p><code>cargo.toml</code> 的内容是这样的：</p><p><img src="/assets/images/toml-f022e4c943d49077fb349504014c8ffb.png"></p><p><code>[package]</code> 下声明的是包的信息，<code>[dependencies]</code> 下声明的是依赖信息。</p><p>安装新依赖通常是编辑<code>Cargo.toml</code>文件，在<code>[dependencies]</code>表中添加新依赖，最后执行<code>cargo build</code>命令（安装依赖）。</p><blockquote><p>删除和更新依赖跟这个类似都需要编辑 Cargo.toml 文件然后执行 cargo build 命令。</p></blockquote><p>然后编译和执行：</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi shell"><pre tabindex="0" class="prism-code language-shell codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token plain">cargo build</span></span><span class="token-line" style="color:#393A34"><span class="token plain">cargo run</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>执行完<code>cargo build</code>会有 <code>Cargo.lock</code>和<code>target</code>目录（编译后的二进制可执行文件<code>./target/debug</code>），<code>cargo</code> 也有类似于 <code>package-lock.json</code> 的 <code>Cargo.lock</code> 来记录了依赖的具体信息：</p><p><img src="/assets/images/cargolock-c6f5c387b0b2f1a7c3ae753d6389dc74.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_jJj8" id="数据类型"></a>数据类型<a class="hash-link" href="#数据类型" title="Direct link to heading">#</a></h2><blockquote><p>Rust 虽然是一门强类型语言，但编译器支持类型推导，这使得写代码时的直观感受和写脚本语言差不多。</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_jJj8" id="所有权"></a>所有权<a class="hash-link" href="#所有权" title="Direct link to heading">#</a></h2><p>所有的程序都必须和计算机内存打交道，从内存中申请空间来存放程序的运行内容，在不需要的时候释放这些空间。对于内存管理，有三种方案：</p><ol><li>垃圾回收机制(GC)，在程序运行时不断寻找不再使用的内存，典型代表：Java、Go、JS</li><li>手动管理内存的分配和释放, 在程序中，通过函数调用的方式来申请和释放内存，典型代表：C++</li><li>通过所有权来管理内存，编译器在编译时会根据一系列规则进行检查</li></ol><p>Rust 选择了第三种，并且这种检查只发生在编译期，对于程序运行期，不会有任何性能上的损失。</p><p>在其它语言中，我们用 <code>var a = &quot;hello world&quot;</code> 的方式给 a 赋值，也就是把等式右边的 <code>&quot;hello world&quot;</code> 字符串赋值给变量 a ，而在 Rust 中，我们这样写： <code>let a = &quot;hello world&quot;</code> ，同时给这个过程起了另一个名字：<strong>变量绑定</strong>。</p><p>之所以用绑定，是因为 Rust 最核心的原则——所有权，简单来讲，任何内存对象都是有主人的，绑定就是把这个内存对象绑定给一个变量，让这个变量成为它的所有者（owner）。</p><p>所有权有两个规则：</p><ol><li>Rust 中每一个值都<strong>只有</strong>一个所有者（值绑定到某个变量上）</li><li>当所有者（变量）离开作用域范围时，这个值将被丢弃（drop）</li></ol><p>比如：</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi rust"><pre tabindex="0" class="prism-code language-rust codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token plain">let s1 = String::from(&quot;hello&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">let s2 = s1;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">println!(&quot;{}, world!&quot;, s1);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>这个会报错，因为值 &quot;hello&quot; 的所有权已经转移（move）到 s2 了，再去访问 s1，Rust 禁止你使用无效的引用。</p><p>再来看这个：</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi rust"><pre tabindex="0" class="prism-code language-rust codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token plain">fn main() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let x: &amp;str = &quot;hello, world&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let y = x;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    println!(&quot;{},{}&quot;,x,y);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>输出：</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi"><pre tabindex="0" class="prism-code language-undefined codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token plain">hello, world,hello, world</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>实际上这里的<code>&amp;str</code> 就是创建一个指向&quot;hello, world&quot;的引用</p></div></div><p>这段代码和之前的 String 有一个本质上的区别：在 String 的例子中 s1 持有了通过 <code>String::from(&quot;hello&quot;)</code> 创建的值的所有权，而这个例子中，x 只是引用了存储在二进制中的字符串 &quot;hello, world&quot;，并没有持有所有权。</p><p>在这里，<code>let y = x</code> ，仅仅是对该引用进行了拷贝，此时 y 和 x 都引用了同一个字符串。</p><p>具体见<a href="#%E5%BC%95%E7%94%A8">引用</a>。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_jJj8" id="copy"></a>copy<a class="hash-link" href="#copy" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi rust"><pre tabindex="0" class="prism-code language-rust codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token plain">let x = 5;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">let y = x;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">println!(&quot;x = {}, y = {}&quot;, x, y);</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>这段代码并不会报错，而是输出：</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi"><pre tabindex="0" class="prism-code language-undefined codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token plain">x = 5, y = 5</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>整型这样的基本类型在编译时是已知大小的，会被存储在栈上，所以拷贝其实际的值是快速的。这意味着没有理由在创建变量 y 后使 x 无效（x、y 都仍然有效）。</p><p>Rust 有一个叫做 Copy 的特征，可以用在类似整型这样在栈中存储的类型。如果一个类型拥有 Copy 特征，一个旧的变量在被赋值给其他变量后仍然可用。</p><p>copy 的规则是：</p><ol><li>任何基本类型的组合可以 Copy</li><li>不需要分配内存或某种形式资源的类型是可以 Copy 的</li></ol><p>具体来说：</p><ul><li>所有整数类型，比如 u32。</li><li>布尔类型，bool，它的值是 true 和 false。</li><li>所有浮点数类型，比如 f64。</li><li>字符类型，char。</li><li>元组，当且仅当其包含的类型也都是 Copy 的时候。比如，(i32, i32) 是 Copy 的，但 (i32, String) 就不是。</li><li>不可变引用 &amp;T ，但是注意: 可变引用 <code>&amp;mut T</code> 是不可以 Copy 的</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_jJj8" id="引用"></a>引用<a class="hash-link" href="#引用" title="Direct link to heading">#</a></h3><p>在 rust 中，引用是基于指针实现的，指针保存的是指向内存的地址，引用可以看作是某块内存的别名（alias），rust 里<code>&amp;</code>操作符不是拿到内存地址，而是基于内存地址封装的引用类型。</p><p>先看一下变量在内存中的地址，以 go 为例：</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi go"><pre tabindex="0" class="prism-code language-go codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> main</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;fmt&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> a </span><span class="token builtin">int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;变量的地址: %x\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>输出：</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi"><pre tabindex="0" class="prism-code language-undefined codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token plain">变量的地址: 140000140a0</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>而指针变量指向了一个值的内存地址，声明一个指针：</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi go"><pre tabindex="0" class="prism-code language-go codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> var_name </span><span class="token operator" style="color:#393A34">*</span><span class="token keyword" style="color:#00009f">var</span><span class="token operator" style="color:#393A34">-</span><span class="token keyword" style="color:#00009f">type</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p><code>var-type</code> 为指针类型，<code>var_name</code> 为指针变量名，<code>*</code> 号用于指定变量是作为一个指针。以下是有效的指针声明：</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi go"><pre tabindex="0" class="prism-code language-go codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> ip </span><span class="token operator" style="color:#393A34">*</span><span class="token builtin">int</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* 指向整型*/</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> fp </span><span class="token operator" style="color:#393A34">*</span><span class="token builtin">float32</span><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* 指向浮点型 */</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>指针类型前面加上 * 号（前缀）来获取指针所指向的内容：</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi go"><pre tabindex="0" class="prism-code language-go codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">package</span><span class="token plain"> main</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;fmt&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> a </span><span class="token builtin">int</span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">/* 声明实际变量 */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> ip </span><span class="token operator" style="color:#393A34">*</span><span class="token builtin">int</span><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* 声明指针变量 */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   ip </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">a  </span><span class="token comment" style="color:#999988;font-style:italic">/* 指针变量的存储地址 */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;a 变量的地址是: %x\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">a  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">/* 指针变量的存储地址 */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;ip 变量储存的指针地址: %x\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> ip </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">/* 使用指针访问值 */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">   fmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Printf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;*ip 变量的值: %d\n&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">ip </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>输出：</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi"><pre tabindex="0" class="prism-code language-undefined codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token plain">a 变量的地址是: 140000140a0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ip 变量储存的指针地址: 140000140a0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">*ip 变量的值: 20</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>但是，在 rust 中，引用<code>&amp;x</code>理解为 x 的借用（borrowing），通过<code>&amp;</code>操作租借所有权（<code>&amp;</code>不可变引用，<code>&amp;mut</code> 可变引用），不过租用所有权会让所有者（owner）受到两个限制：</p><ol><li>不可变引用期间，owner 不能修改资源，并且不能再进行可变引用</li><li>可变引用期间，owner 不能访问资源，并且不能再出借所有权
备注，可变引用就是允许修改变量的值：</li></ol><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi rust"><pre tabindex="0" class="prism-code language-rust codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token plain">fn main() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let mut s = String::from(&quot;hello&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    change(&amp;mut s);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fn change(some_string: &amp;mut String) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    some_string.push_str(&quot;, world&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    println!(&quot;{}&quot;, some_string);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>输出：</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi"><pre tabindex="0" class="prism-code language-undefined codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token plain">hello, world</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>关于引用：</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi rust"><pre tabindex="0" class="prism-code language-rust codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token plain">fn main() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let s1 = String::from(&quot;hello&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let len = calculate_length(&amp;s1);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    println!(&quot;The length of &#x27;{}&#x27; is {}.&quot;, s1, len);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fn calculate_length(s: &amp;String) -&gt; usize {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    s.len()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>输出：The length of &#x27;hello&#x27; is 5.</p><p>注意，这里是把 s1 的引用作为参数传递给 calculate_length 函数，而不是把 s1 的所有权转移给该函数。&amp; 符号即是引用，它们允许你使用值，但是不获取所有权（租借所有权）；通过 &amp;s1 语法，我们创建了一个指向 s1 的引用，但是并不拥有它。因为并不拥有这个值，当引用离开作用域后，其指向的值也不会被丢弃。</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi rust"><pre tabindex="0" class="prism-code language-rust codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token plain">use std::any::type_name;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fn test_type&lt;T&gt;(_: T) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    println!(&quot;{:?}&quot;, { type_name::&lt;T&gt;() });</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">fn main() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let x = 5;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    let y = &amp;x;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 判断类型</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    test_type(x);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    test_type(y); //  可以使用值，但是是引用类型</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    test_type(*y); // 解引用，拿到值</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    print!(&quot;x is {} and y is {}, 解引用 {}&quot;, x, y, *y);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>输出：</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi"><pre tabindex="0" class="prism-code language-undefined codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token plain">&quot;i32&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;&amp;i32&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;i32&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">x is 5 and y is 5, 解引用 5</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>注意：使用 <code>*y</code> 来解出引用所指向的值（也就是解引用）</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_jJj8" id="生命周期"></a>生命周期<a class="hash-link" href="#生命周期" title="Direct link to heading">#</a></h2></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/探索/Rust.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_UQtd" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_QETb"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/不只是前端/一些面试"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 一些面试</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/探索/Go"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Go »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_GySF thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#rust-的包管理工具" class="table-of-contents__link">rust 的包管理工具</a></li><li><a href="#数据类型" class="table-of-contents__link">数据类型</a></li><li><a href="#所有权" class="table-of-contents__link">所有权</a><ul><li><a href="#copy" class="table-of-contents__link">copy</a></li><li><a href="#引用" class="table-of-contents__link">引用</a></li></ul></li><li><a href="#生命周期" class="table-of-contents__link">生命周期</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">笔记📒</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_mu0C"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_mu0C"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_mu0C"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/physicshi" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_mu0C"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 wsgy, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a7495c96.js"></script>
<script src="/assets/js/main.c78f278f.js"></script>
</body>
</html>