<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="æˆ‘çš„ç§˜å¯†åŸºåœ° Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="æˆ‘çš„ç§˜å¯†åŸºåœ° Blog Atom Feed"><title data-react-helmet="true">æ¦‚è§ˆ | æˆ‘çš„ç§˜å¯†åŸºåœ°</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://physicshi.github.io/docs/Babel/æ¦‚è§ˆ"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="æ¦‚è§ˆ | æˆ‘çš„ç§˜å¯†åŸºåœ°"><meta data-react-helmet="true" name="description" content="babel æœ€å¼€å§‹å« 6to5ï¼Œæ˜¯ es6 è½¬ es5ï¼Œä»è¿™ä¸ªæœ€åˆçš„åå­—ä¹Ÿå¯ä»¥çŸ¥é“ï¼Œbabel æ˜¯ä¸€ä¸ª js è½¬è¯‘å™¨ã€‚"><meta data-react-helmet="true" property="og:description" content="babel æœ€å¼€å§‹å« 6to5ï¼Œæ˜¯ es6 è½¬ es5ï¼Œä»è¿™ä¸ªæœ€åˆçš„åå­—ä¹Ÿå¯ä»¥çŸ¥é“ï¼Œbabel æ˜¯ä¸€ä¸ª js è½¬è¯‘å™¨ã€‚"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://physicshi.github.io/docs/Babel/æ¦‚è§ˆ"><link data-react-helmet="true" rel="alternate" href="https://physicshi.github.io/docs/Babel/æ¦‚è§ˆ" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://physicshi.github.io/docs/Babel/æ¦‚è§ˆ" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.28eae8ec.css">
<link rel="preload" href="/assets/js/runtime~main.547ae20c.js" as="script">
<link rel="preload" href="/assets/js/main.af06e908.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_RZKW">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_RFGx themedImage--light_Ble8 navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedImage_RFGx themedImage--dark_wwiP navbar__logo"><b class="navbar__title">ç§˜å¯†åŸºåœ°</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">ç¬”è®°ğŸ“’</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/physicshi" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_mu0C"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_nWAW react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_MFxJ">ğŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_MFxJ">ğŸŒ</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_IIrL"><button class="clean-btn backToTopButton_x+Rm" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_psz0"><div class="sidebar_aYCW"><nav class="menu thin-scrollbar menu_h+Ol menuWithAnnouncementBar_GKH3"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">å†™åœ¨å‰é¢</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">æµè§ˆå™¨</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">CSS</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">JavaScript</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Webpack</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Vite</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Babel</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Babel/æ¦‚è§ˆ">æ¦‚è§ˆ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Babel/BabelConfig">BabelConfig</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">React</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">NodeJS</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">æ¢ç´¢</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">leetcode</a></li></ul></nav></div></aside><main class="docMainContainer_jMVY"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_+GTl"><div class="docItemContainer_RH7h"><article><div class="tocCollapsible_y1bX tocMobile_zI+Y"><button type="button" class="clean-btn tocCollapsibleButton_U+cm">On this page</button></div><div class="markdown"><header><h1>æ¦‚è§ˆ</h1></header><p>babel æœ€å¼€å§‹å« 6to5ï¼Œæ˜¯ es6 è½¬ es5ï¼Œä»è¿™ä¸ªæœ€åˆçš„åå­—ä¹Ÿå¯ä»¥çŸ¥é“ï¼Œbabel æ˜¯ä¸€ä¸ª js è½¬è¯‘å™¨ã€‚</p><p>babel è½¬è¯‘å­˜åœ¨ä¸‰ä¸ªé˜¶æ®µï¼š</p><p><img src="https://tvax4.sinaimg.cn/large/006T9etDly1h1vjgtakmcj31aq0i2gq7.jpg" alt="image"></p><ul><li>parseï¼šé€šè¿‡ parser æŠŠæºç è½¬æˆæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰</li><li>transformï¼šéå† ASTï¼Œè°ƒç”¨å„ç§ transform æ’ä»¶å¯¹ AST è¿›è¡Œå¢åˆ æ”¹</li><li>generateï¼šæŠŠè½¬æ¢åçš„ AST æ‰“å°æˆç›®æ ‡ä»£ç ï¼Œå¹¶ç”Ÿæˆ sourcemap</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_jJj8" id="babel-æ ¸å¿ƒåŒ…"></a>Babel æ ¸å¿ƒåŒ…<a class="hash-link" href="#babel-æ ¸å¿ƒåŒ…" title="Direct link to heading">#</a></h2><ul><li>@babel/coreï¼šè´Ÿè´£è½¬è¯‘çš„æ ¸å¿ƒåŒ…ï¼ŒåŒ…å«äº†æ•´ä¸ª babel çš„å·¥ä½œæµï¼ˆå·²é›†æˆ @babel/typesï¼‰</li><li>@babel/parserï¼šè´Ÿè´£è§£ææºç ï¼Œå¹¶ç”Ÿæˆ AST</li><li>@babel/traverseï¼šè´Ÿè´£éå† ASTï¼Œå¹¶å¯¹ AST è¿›è¡Œå¢åˆ æ”¹</li><li>@babel/generatorï¼šè´Ÿè´£ç”Ÿæˆç›®æ ‡ä»£ç </li><li>@babel/typesï¼šåŒ…å«æ‰‹åŠ¨æ„å»º AST ä»¥åŠæ£€æŸ¥ AST èŠ‚ç‚¹ç±»å‹çš„æ–¹æ³•</li><li>@babel/templateï¼šæ‰¹é‡ç”Ÿæˆ AST èŠ‚ç‚¹ï¼ˆå¯ä»¥å°†å­—ç¬¦ä¸²ä»£ç ç‰‡æ®µè½¬æ¢ä¸º AST èŠ‚ç‚¹ï¼‰</li></ul><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi shell"><pre tabindex="0" class="prism-code language-shell codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">pnpm</span><span class="token plain"> i @babel/core @babel/parser @babel/traverse @babel/generator @babel/types @babel/template -D</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_jJj8" id="babel-çš„-ast"></a>Babel çš„ AST<a class="hash-link" href="#babel-çš„-ast" title="Direct link to heading">#</a></h2><p>ä¹‹æ‰€ä»¥å«æŠ½è±¡è¯­æ³•æ ‘ AST æ˜¯å› ä¸ºçœç•¥æ‰äº†æºç ä¸­çš„åˆ†éš”ç¬¦ã€æ³¨é‡Šç­‰å†…å®¹ï¼ŒAST ä¹Ÿæ˜¯æœ‰æ ‡å‡†çš„ï¼ŒJS parser çš„ AST å¤§å¤šæ˜¯ estree æ ‡å‡†ï¼Œä» SpiderMonkey çš„ AST æ ‡å‡†æ‰©å±•è€Œæ¥ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <a href="https://astexplorer.net/" target="_blank" rel="noopener noreferrer">AST Explorer</a> æ¥æŸ¥çœ‹ AST çš„ç»“æ„ï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒAST æ˜¯ä¸€ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ª type å±æ€§ï¼Œè¡¨ç¤ºèŠ‚ç‚¹çš„ç±»å‹ï¼Œæ¯”å¦‚ï¼š</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi json"><pre tabindex="0" class="prism-code language-json codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Program&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;start&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;end&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;body&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ExpressionStatement&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;start&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;end&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;expression&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Literal&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;start&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;end&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;hello&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>AST çš„ç±»å‹ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>File</td><td>æ–‡ä»¶ (é¡¶å±‚èŠ‚ç‚¹åŒ…å« Program)</td></tr><tr><td>Program</td><td>æ•´ä¸ªç¨‹åºèŠ‚ç‚¹ (åŒ…å« body å±æ€§ä»£è¡¨ç¨‹åºä½“)</td></tr><tr><td>Directive</td><td>æŒ‡ä»¤ (ä¾‹å¦‚ &quot;use strict&quot;)</td></tr><tr><td>Comment</td><td>ä»£ç æ³¨é‡Š</td></tr><tr><td>Statement</td><td>è¯­å¥ (å¯ç‹¬ç«‹æ‰§è¡Œçš„è¯­å¥)</td></tr><tr><td>Literal</td><td>å­—é¢é‡ (åŸºæœ¬æ•°æ®ç±»å‹ã€å¤æ‚æ•°æ®ç±»å‹ç­‰å€¼ç±»å‹)</td></tr><tr><td>Identifier</td><td>æ ‡è¯†ç¬¦ (å˜é‡åã€å±æ€§åã€å‡½æ•°åã€å‚æ•°åç­‰)</td></tr><tr><td>Declaration</td><td>å£°æ˜ (å˜é‡å£°æ˜ã€å‡½æ•°å£°æ˜ã€Importã€Export å£°æ˜ç­‰)</td></tr><tr><td>Specifier</td><td>å…³é”®å­— (ImportSpecifierã€ImportDefaultSpecifierã€ImportNamespaceSpecifierã€ExportSpecifier)</td></tr><tr><td>Expression</td><td>è¡¨è¾¾å¼</td></tr></tbody></table><p>å…¬å…±å±æ€§</p><table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>type</td><td>AST èŠ‚ç‚¹çš„ç±»å‹</td></tr><tr><td>start</td><td>è®°å½•è¯¥èŠ‚ç‚¹ä»£ç å­—ç¬¦ä¸²èµ·å§‹ä¸‹æ ‡</td></tr><tr><td>end</td><td>è®°å½•è¯¥èŠ‚ç‚¹ä»£ç å­—ç¬¦ä¸²ç»“æŸä¸‹æ ‡</td></tr><tr><td>loc</td><td>å†…å« lineã€column å±æ€§ï¼Œåˆ†åˆ«è®°å½•å¼€å§‹ç»“æŸçš„è¡Œåˆ—å·</td></tr><tr><td>leadingComments</td><td>å¼€å§‹çš„æ³¨é‡Š</td></tr><tr><td>innerComments</td><td>ä¸­é—´çš„æ³¨é‡Š</td></tr><tr><td>trailingComments</td><td>ç»“å°¾çš„æ³¨é‡Š</td></tr><tr><td>extra</td><td>é¢å¤–ä¿¡æ¯</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_jJj8" id="babelparser"></a><code>@babel/parser</code><a class="hash-link" href="#babelparser" title="Direct link to heading">#</a></h2><p>å¯¹äº<code>@babel/parser</code>ï¼š</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi ts"><pre tabindex="0" class="prism-code language-ts codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">input</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token operator" style="color:#393A34">?</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">ParserOptions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token maybe-class-name">File</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// è¿™é‡Œè¿”å›çš„æ˜¯æ•´ä¸ª AST</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>è¿™é‡Œçš„ <code>input</code> æ˜¯æºç ï¼Œ<code>options</code> æ˜¯è§£æå™¨çš„é…ç½®ï¼Œé»˜è®¤æ˜¯ <code>{}</code>ã€‚è¿™é‡Œ parse é…ç½®ä¸»è¦æ˜¯ï¼š</p><ul><li>pluginsï¼š æŒ‡å®š jsxã€typescriptã€flow ç­‰æ’ä»¶æ¥è§£æå¯¹åº”çš„è¯­æ³•</li><li>sourceTypeï¼š æŒ‡å®šæ˜¯å¦æ”¯æŒè§£ææ¨¡å—è¯­æ³•ï¼Œæœ‰ moduleã€scriptã€unambiguous 3 ä¸ªå–å€¼ï¼Œmodule æ˜¯è§£æ es module è¯­æ³•ï¼Œscript åˆ™ä¸è§£æ es module è¯­æ³•ï¼Œå½“ä½œè„šæœ¬æ‰§è¡Œï¼Œunambiguous åˆ™æ˜¯æ ¹æ®å†…å®¹æ˜¯å¦æœ‰ import å’Œ export æ¥ç¡®å®šæ˜¯å¦è§£æ es module è¯­æ³•ã€‚</li></ul><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi js"><pre tabindex="0" class="prism-code language-js codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// parse tsx æ¨¡å—</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;@babel/parser&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;code&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">sourceType</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;module&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">plugins</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;jsx&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;typescript&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_jJj8" id="babeltraverse-æ ¸å¿ƒ"></a><code>@babel/traverse</code> (æ ¸å¿ƒ)<a class="hash-link" href="#babeltraverse-æ ¸å¿ƒ" title="Direct link to heading">#</a></h2><p>Babel æ’ä»¶æœ¬è´¨ä¸Šå°±æ˜¯ç¼–å†™å„ç§ visitor å»è®¿é—® AST ä¸Šçš„èŠ‚ç‚¹ï¼Œå¹¶è¿›è¡Œ traverseã€‚å½“é‡åˆ°å¯¹åº”ç±»å‹çš„èŠ‚ç‚¹ï¼Œvisitor å°±ä¼šåšå‡ºç›¸åº”çš„å¤„ç†ï¼Œä»è€Œå°†åŸæœ¬çš„ä»£ç  transform æˆæœ€ç»ˆçš„ä»£ç ã€‚</p><blockquote><p>ç¼–å†™ä¸€ä¸ª Babel æ’ä»¶ï¼Œè¦åšçš„äº‹æƒ…å°±æ˜¯å›ä¼ ä¸€ä¸ª visitor å¯¹è±¡ï¼Œå®šä¹‰ä»¥ Node Type ä¸ºåç§°çš„å‡½æ•°ã€‚è¯¥å‡½æ•°æ¥æ”¶ path,state ä¸¤ä¸ªå‚æ•°ã€‚</p></blockquote><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi js"><pre tabindex="0" class="prism-code language-js codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">traverse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">ast</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> opts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><ul><li>astï¼šç»è¿‡ parse ä¹‹åçš„ç”Ÿæˆçš„ AST</li><li>opts ï¼šæŒ‡å®š visitor å‡½æ•°--babel ä¼šåœ¨éå† AST æ—¶è°ƒç”¨ç›¸åº”çš„ visitor å‡½æ•°</li></ul><p>æ–¹æ³•çš„ç¬¬äºŒå‚æ•°ä¸­çš„ visitor æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰æ’ä»¶æ—¶ç»å¸¸ç”¨åˆ°çš„åœ°æ–¹ï¼Œä½ å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥å®šä¹‰è¿™ä¸ªå‚æ•°ï¼š</p><ol><li>ç¬¬ä¸€ç§æ˜¯ä»¥æ–¹æ³•çš„å½¢å¼å£°æ˜ visitor -- ç›¸å½“äºæ˜¯ enter æ—¶è°ƒç”¨çš„å‡½æ•°</li></ol><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi js"><pre tabindex="0" class="prism-code language-js codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">traverse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ast</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function maybe-class-name" style="color:#d73a49">BlockStatement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">path</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;BlockStatement&gt;&gt;&gt;&gt;&gt;&gt;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><ol start="2"><li>ç¬¬äºŒç§æ˜¯ä»¥å¯¹è±¡çš„å½¢å¼å£°æ˜ visitor -- å¯ä»¥æ˜ç¡®æŒ‡å®š enter æˆ–è€… exit æ—¶çš„å¤„ç†å‡½æ•°</li></ol><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi js"><pre tabindex="0" class="prism-code language-js codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">traverse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ast</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">BlockStatement</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">enter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">path</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;enter&gt;&gt;&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">path</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;exit&gt;&gt;&gt;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>æ¯ä¸€ä¸ª visitor å‡½æ•°ä¼šæ¥æ”¶ä¸¤ä¸ªå‚æ•° path å’Œ stateï¼Œpath ç”¨æ¥æ“ä½œèŠ‚ç‚¹ã€éå†èŠ‚ç‚¹å’Œåˆ¤æ–­èŠ‚ç‚¹ï¼Œä¾‹å¦‚ path.node å¯ä»¥è®¿é—®å½“å‰èŠ‚ç‚¹ï¼Œpath.parent å¯ä»¥è®¿é—®çˆ¶èŠ‚ç‚¹ç­‰ã€‚path.remove()å¯ä»¥ç§»é™¤å½“å‰èŠ‚ç‚¹ã€‚</p><p><img src="https://tva1.sinaimg.cn/large/006T9etDly1h1vkse3c7aj319e08o76z.jpg" alt="image"></p><p>è€Œ state åˆ™æ˜¯éå†è¿‡ç¨‹ä¸­åœ¨ä¸åŒèŠ‚ç‚¹ä¹‹é—´ä¼ é€’æ•°æ®çš„æœºåˆ¶ï¼Œ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ state å­˜å‚¨ä¸€äº›éå†è¿‡ç¨‹ä¸­çš„å…±äº«æ•°æ®ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_jJj8" id="babeltypes"></a><code>@babel/types</code><a class="hash-link" href="#babeltypes" title="Direct link to heading">#</a></h2><p>åˆ›å»ºä¸€äº› AST å’Œåˆ¤æ–­ AST çš„ç±»å‹ç”¨åˆ°çš„ï¼Œæ¯”å¦‚ï¼š</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi js"><pre tabindex="0" class="prism-code language-js codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports operator" style="color:#393A34">*</span><span class="token imports"> </span><span class="token imports keyword module" style="color:#00009f">as</span><span class="token imports"> types</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@babel/types&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ˜¯å¦ä¸ºæ ‡è¯†ç¬¦ç±»å‹èŠ‚ç‚¹</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">isIdentifier</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ˜¯å¦ä¸ºæ•°å­—å­—é¢é‡èŠ‚ç‚¹</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">isNumberLiteral</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// æ˜¯å¦ä¸ºè¡¨è¾¾å¼è¯­å¥èŠ‚ç‚¹</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">isExpressionStatement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>å› ä¸ºå¯ä»¥åˆ›å»ºä¸€äº› AST å’Œåˆ¤æ–­ AST çš„ç±»å‹ï¼Œ<strong>æˆ‘ä»¬å¯ä»¥ç”¨@babel/types åŒ…æ¥å†™ä»£ç </strong>ï¼ˆBabel Types ç”Ÿæˆçš„ AST èŠ‚ç‚¹éœ€ä½¿ç”¨@babel/generator è½¬æ¢åå¾—åˆ°ç›¸åº”ä»£ç ï¼‰ï¼š</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi js"><pre tabindex="0" class="prism-code language-js codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports operator" style="color:#393A34">*</span><span class="token imports"> </span><span class="token imports keyword module" style="color:#00009f">as</span><span class="token imports"> types</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@babel/types&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">generator</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@babel/generator&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> generate </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> generator</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// https://github.com/babel/babel/issues/13719</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">log</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">generate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">node</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">code</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringLiteral</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Hello World&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// output: { type: &#x27;StringLiteral&#x27;, value: &#x27;Hello World&#x27; }</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// è¿™æ˜¯æœ€ç®€å•çš„ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²èŠ‚ç‚¹</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">stringLiteral</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Hello World&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// output: &quot;Hello World&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">variableDeclaration</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;const&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">variableDeclarator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">identifier</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;a&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> types</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">numericLiteral</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// output: const a = 1;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>ç”šè‡³å¯ä»¥é€šè¿‡ Babel Types ç”Ÿæˆ react ä»£ç ã€‚</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_jJj8" id="babelgenerator"></a><code>@babel/generator</code><a class="hash-link" href="#babelgenerator" title="Direct link to heading">#</a></h2><p>è½¬æ¢å®Œ AST ä¹‹åï¼Œå°±è¦æ‰“å°ç›®æ ‡ä»£ç å­—ç¬¦ä¸²ï¼Œè¿™é‡Œé€šè¿‡@babel/generator æ¥å®ç°ï¼š</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi js"><pre tabindex="0" class="prism-code language-js codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">generator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter literal-property property" style="color:#36acaa">ast</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter known-class-name class-name">Object</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> </span><span class="token parameter literal-property property" style="color:#36acaa">opts</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> </span><span class="token parameter known-class-name class-name">Object</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> </span><span class="token parameter literal-property property" style="color:#36acaa">code</span><span class="token parameter operator" style="color:#393A34">:</span><span class="token parameter"> string</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> map</span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æ‰“å°çš„ AST</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯ optionsï¼ŒæŒ‡å®šæ‰“å°çš„ä¸€äº›ç»†èŠ‚ï¼Œæ¯”å¦‚é€šè¿‡ comments æŒ‡å®šæ˜¯å¦åŒ…å«æ³¨é‡Šï¼Œé€šè¿‡ minified æŒ‡å®šæ˜¯å¦åŒ…å«ç©ºç™½å­—ç¬¦</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°å½“å¤šä¸ªæ–‡ä»¶åˆå¹¶æ‰“å°çš„æ—¶å€™éœ€è¦ç”¨åˆ°</li></ul><p>options ä¸­å¸¸ç”¨çš„æ˜¯ sourceMapsï¼Œå¼€å¯äº†è¿™ä¸ªé€‰é¡¹æ‰ä¼šç”Ÿæˆ sourcemap</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi js"><pre tabindex="0" class="prism-code language-js codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> map </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">generate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ast</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">sourceMaps</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_jJj8" id="babel-çš„å†…ç½®åŠŸèƒ½"></a>Babel çš„å†…ç½®åŠŸèƒ½<a class="hash-link" href="#babel-çš„å†…ç½®åŠŸèƒ½" title="Direct link to heading">#</a></h2><p>babel çš„ plugin æ˜¯åœ¨é…ç½®æ–‡ä»¶é‡Œé¢é€šè¿‡ plugins é€‰é¡¹é…ç½®ï¼Œå€¼ä¸ºå­—ç¬¦ä¸²æˆ–è€…æ•°ç»„ï¼š</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi json"><pre tabindex="0" class="prism-code language-json codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;plugins&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;pluginA&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;pluginB&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">&quot;pluginC&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">/* options */</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><blockquote><p>å¦‚æœéœ€è¦ä¼ å‚å°±ç”¨æ•°ç»„æ ¼å¼ï¼Œç¬¬äºŒä¸ªå…ƒç´ ä¸ºå‚æ•°ã€‚</p></blockquote><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†å‡ ä¸ªç”¨äºå®ç°æ’ä»¶çš„ apiï¼Œè€Œ babel æœ¬èº«ä¸ºäº†å®ç°å¯¹è¯­æ³•ç‰¹æ€§çš„è½¬æ¢ä»¥åŠå¯¹ api çš„æ”¯æŒ(polyfill)ï¼Œä¹Ÿå†…ç½®äº†å¾ˆå¤šçš„æ’ä»¶(plugin)å’Œé¢„è®¾(preset)ã€‚</p><p>å…¶æ’ä»¶ä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š</p><ul><li>syntax pluginï¼šåªæ˜¯åœ¨ parse é˜¶æ®µä½¿ç”¨ï¼Œå¯ä»¥è®© parser èƒ½å¤Ÿæ­£ç¡®çš„è§£æå¯¹åº”çš„è¯­æ³•æˆ AST</li><li>transform pluginï¼šæ˜¯å¯¹ AST çš„è½¬æ¢ï¼Œé’ˆå¯¹ es20xx ä¸­çš„è¯­è¨€ç‰¹æ€§ã€typescriptã€jsx ç­‰çš„è½¬æ¢éƒ½æ˜¯åœ¨è¿™éƒ¨åˆ†å®ç°çš„</li><li>proposal pluginï¼šæœªåŠ å…¥è¯­è¨€æ ‡å‡†çš„ç‰¹æ€§çš„ AST è½¬æ¢æ’ä»¶</li></ul><p>è€Œé¢„è®¾å…¶å®å°±æ˜¯å¯¹äºæ’ä»¶çš„ä¸€å±‚å°è£…ï¼Œé€šè¿‡é…ç½®é¢„è®¾ï¼Œä½¿ç”¨è€…å¯ä»¥ä¸ç”¨å…³å¿ƒå…·ä½“å¼•ç”¨äº†ä»€ä¹ˆæ’ä»¶ï¼Œä»è€Œå‡è½»ä½¿ç”¨è€…çš„è´Ÿæ‹…ã€‚</p><p>æ ¹æ®ä¸Šé¢ä¸åŒç±»å‹çš„æ’ä»¶åˆäº§ç”Ÿäº†å¦‚ä¸‹å‡ ç§é¢„è®¾ï¼š</p><ul><li>ä¸“é—¨æ ¹æ® es æ ‡å‡†å¤„ç†è¯­è¨€ç‰¹æ€§çš„é¢„è®¾ -- babel-preset-es20xx</li><li>å¯¹ reactã€ts å…¼å®¹çš„é¢„è®¾ -- preset-react preset-typescript</li></ul><p>babel plugin æœ‰ä¸¤ç§æ ¼å¼ï¼š</p><ol><li>è¿”å›å¯¹è±¡çš„å‡½æ•°</li></ol><p>ç¬¬ä¸€ç§æ˜¯ä¸€ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡çš„æ ¼å¼ï¼Œå¯¹è±¡é‡Œæœ‰ visitorã€preã€postã€inheritsã€manipulateOptions ç­‰å±æ€§ã€‚</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi js"><pre tabindex="0" class="prism-code language-js codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">api</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> options</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> dirname</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">inherits</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> parentPlugin</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">manipulateOptions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">options</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> parserOptions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">xxx</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">pre</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cache</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// æ’ä»¶çš„æ ¸å¿ƒé€»è¾‘</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">visitor</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function maybe-class-name" style="color:#d73a49">StringLiteral</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">path</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cache</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>é¦–å…ˆï¼Œæ’ä»¶å‡½æ•°æœ‰ 3 ä¸ªå‚æ•°ï¼Œapiã€optionsã€dirnameï¼š</p><ul><li>options å°±æ˜¯å¤–é¢ä¼ å…¥çš„å‚æ•°</li><li>dirname æ˜¯ç›®å½•åï¼ˆä¸å¸¸ç”¨ï¼‰</li><li>api é‡ŒåŒ…å«äº†å„ç§ babel çš„ apiï¼Œæ¯”å¦‚ typesã€template ç­‰ï¼Œè¿™äº›åŒ…å°±ä¸ç”¨åœ¨æ’ä»¶é‡Œå•ç‹¬å•ç‹¬å¼•å…¥äº†ï¼Œç›´æ¥å–æ¥ç”¨å°±è¡Œã€‚</li></ul><p>è¿”å›çš„å¯¹è±¡æœ‰ inheritsã€manipulateOptionsã€preã€visitorã€post ç­‰å±æ€§ï¼š</p><ul><li>inherits æŒ‡å®šç»§æ‰¿æŸä¸ªæ’ä»¶ï¼Œå’Œå½“å‰æ’ä»¶çš„ options åˆå¹¶ï¼Œé€šè¿‡ Object.assign çš„æ–¹å¼</li><li>visitor æŒ‡å®š traverse æ—¶è°ƒç”¨çš„å‡½æ•°</li><li>pre å’Œ post åˆ†åˆ«åœ¨éå†å‰åè°ƒç”¨ï¼Œå¯ä»¥åšä¸€äº›æ’ä»¶è°ƒç”¨å‰åçš„é€»è¾‘ï¼Œæ¯”å¦‚å¯ä»¥å¾€ fileï¼ˆè¡¨ç¤ºæ–‡ä»¶çš„å¯¹è±¡ï¼Œåœ¨æ’ä»¶é‡Œé¢é€šè¿‡ state.file æ‹¿åˆ°ï¼‰ä¸­æ”¾ä¸€äº›ä¸œè¥¿ï¼Œåœ¨éå†çš„è¿‡ç¨‹ä¸­å–å‡ºæ¥</li><li>manipulateOptions ç”¨äºä¿®æ”¹ optionsï¼Œæ˜¯åœ¨æ’ä»¶é‡Œé¢ä¿®æ”¹é…ç½®çš„æ–¹å¼ï¼Œæ¯”å¦‚ syntaxt plugin ä¸€èˆ¬éƒ½ä¼šä¿®æ”¹ parser options</li></ul><p>æ’ä»¶åšçš„äº‹æƒ…å°±æ˜¯é€šè¿‡ api æ‹¿åˆ° typesã€template ç­‰ï¼Œé€šè¿‡ state.opts æ‹¿åˆ°å‚æ•°ï¼Œç„¶åé€šè¿‡ path æ¥ä¿®æ”¹ ASTã€‚å¯ä»¥é€šè¿‡ state æ”¾ä¸€äº›éå†è¿‡ç¨‹ä¸­å…±äº«çš„æ•°æ®ï¼Œé€šè¿‡ file æ”¾ä¸€äº›æ•´ä¸ªæ’ä»¶éƒ½èƒ½è®¿é—®åˆ°çš„ä¸€äº›æ•°æ®ï¼Œé™¤äº†è¿™ä¸¤ç§ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ this æ¥ä¼ é€’æœ¬å¯¹è±¡å…±äº«çš„æ•°æ®</p><ol start="2"><li>å¯¹è±¡</li></ol><p>æ’ä»¶çš„ç¬¬äºŒç§æ ¼å¼å°±æ˜¯ç›´æ¥å†™ä¸€ä¸ªå¯¹è±¡ï¼Œä¸ç”¨å‡½æ•°åŒ…è£¹ï¼Œè¿™ç§æ–¹å¼ç”¨äºä¸éœ€è¦å¤„ç†å‚æ•°çš„æƒ…å†µã€‚</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi js"><pre tabindex="0" class="prism-code language-js codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> plugin </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">pre</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cache</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Map</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">visitor</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function maybe-class-name" style="color:#d73a49">StringLiteral</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">path</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cache</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">state</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">cache</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><ul><li><a href="https://juejin.cn/post/7018563244679757855" target="_blank" rel="noopener noreferrer">import æ–¹å¼éšæ„äº’è½¬ï¼Œæ„Ÿå— babel æ’ä»¶çš„å¨åŠ›</a> ä»¥åŠç¥å…‰å“¥çš„å°å†Œ</li></ul><p>ä¸¾ä¾‹ï¼š</p><p>babel-plugin-transform-object-assign æºç </p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi js"><pre tabindex="0" class="prism-code language-js codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> declare </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;@babel/helper-plugin-utils&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">declare</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">api</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">assertVersion</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">7</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">name</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;transform-object-assign&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">visitor</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function-variable function maybe-class-name" style="color:#d73a49">CallExpression</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">path</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> file</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;callee&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">matchesPattern</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Object.assign&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">node</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">callee</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> file</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addHelper</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;extends&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>ä¸Šé¢çš„å°±æ˜¯ babel-plugin-transform-object-assign çš„æºç ã€‚</p><ul><li>declareï¼šæ˜¯ä¸€ä¸ªç”¨äºç®€åŒ–åˆ›å»º transformer çš„å·¥å…·å‡½æ•°</li><li>assertVersionï¼šæ£€æŸ¥å½“å‰ babel çš„å¤§ç‰ˆæœ¬ -&gt; è¿™é‡Œå°±é€šè¿‡ api ç›´æ¥æ‹¿æ¥ç”¨</li><li>nameï¼šå½“å‰æ’ä»¶çš„åå­—</li><li>visitorï¼šå¯¹å¤–æä¾›ä¿®æ”¹å†…å®¹çš„è®¿é—®è€…</li><li>CallExpressionï¼šå‡½æ•°è°ƒç”¨çš„ typeï¼Œæ¯ä¸€å¥ä»£ç éƒ½ä¼šç”Ÿæˆå¯¹åº”çš„ typeï¼Œä¾‹å¦‚æœ€ä¸Šé¢çš„å‡½æ•°å abc åˆ™å¯¹åº”çš„æ˜¯ä¸€ä¸ª Identifier ç±»å‹ï¼Œå¦‚æœéœ€è¦ä¿®æ”¹æŸä¸€ä¸ª type çš„ä»£ç ï¼Œåˆ™åœ¨é‡Œé¢åˆ›å»ºå¯¹åº”çš„ type è®¿é—®è€…è¿›è¡Œä¿®æ”¹å³å¯ã€‚</li></ul><p>å…·ä½“ç”Ÿæˆçš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi js"><pre tabindex="0" class="prism-code language-js codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// input</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">assign</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">b</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// output</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_extends</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  _extends </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">assign</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">target</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> source </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> key </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">prototype</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">hasOwnProperty</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">source</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            target</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> target</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> _extends</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_extends</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">b</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_jJj8" id="babel-æ’ä»¶å®æˆ˜---æ¸…é™¤-console-æºç "></a>Babel æ’ä»¶å®æˆ˜ - æ¸…é™¤ console æºç <a class="hash-link" href="#babel-æ’ä»¶å®æˆ˜---æ¸…é™¤-console-æºç " title="Direct link to heading">#</a></h2><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi js"><pre tabindex="0" class="prism-code language-js codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> babel </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;@babel/core&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> get </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;lodash/get&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> eq </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;lodash/eq&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> transformAsync </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> babel</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> removeConsole </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">visitor</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function-variable function maybe-class-name" style="color:#d73a49">ExpressionStatement</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">path</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">path</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;node.expression.callee.object.name&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CONSOLE_PREFIX</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;console&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token function" style="color:#d73a49">eq</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">name</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">CONSOLE_PREFIX</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      path</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">remove</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> transformCode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">code </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">transformAsync</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">plugins</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">removeConsole</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">log</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">code</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">transformCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c"></span></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    const a = 10;</span></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    console.group(&#x27;a&#x27;);</span></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    console.log(a);</span></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">    console.groupEnd();</span></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c"></span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>è¾“å‡ºç»“æœï¼š</p><div class="codeBlockContainer_JfZT"><div class="codeBlockContent_4mTi js"><pre tabindex="0" class="prism-code language-js codeBlock_P3uO thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_+v3f"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> a </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ww6L clean-btn">Copy</button></div></div><p>ä¸Šé¢çš„åŠŸèƒ½å°±æ˜¯æˆ‘ä»¬åœ¨å£°æ˜è¯­å¥ç±»å‹ ExpressionStatement ä¸­å®ç°çš„ã€‚</p><ul><li>node.expression å¯¹åº”çš„æ˜¯å½“å‰ç±»å‹é‡Œçš„å­è¡¨è¾¾å¼ï¼Œåœ¨è¿™ä¸ªåœºæ™¯é‡Œï¼Œå®ƒçš„ type === &#x27;CallExpression&#x27;</li><li>callee å¯¹åº”çš„å°±æ˜¯ä¸€ä¸ªè°ƒç”¨å‡½æ•°ç±»å‹ï¼Œåœ¨è¿™ä¸ªåœºæ™¯é‡Œï¼Œå®ƒçš„ type === &#x27;MemberExpression&#x27;</li><li>object å¯¹åº”çš„å°±æ˜¯å½“å‰è°ƒç”¨å‡½æ•°çš„å‰ç½®å¯¹è±¡ï¼Œå®ƒçš„ type === &#x27;Identifier&#x27;ï¼Œname åˆ™æ˜¯ console</li></ul><p>æ‰€ä»¥æˆ‘ä»¬çš„å®ç°å°±å¾ˆç®€å•äº†ï¼Œåªè¦ name === &#x27;console&#x27; ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å†…éƒ¨æš´éœ²çš„ remove æ–¹æ³•ç›´æ¥åˆ é™¤å½“å‰ä»£ç ã€‚</p></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/main/website/docs/Babel/æ¦‚è§ˆ.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_UQtd" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_QETb"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Vite/VitePlugin"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« VitePlugin</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Babel/BabelConfig"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">BabelConfig Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_GySF thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#babel-æ ¸å¿ƒåŒ…" class="table-of-contents__link">Babel æ ¸å¿ƒåŒ…</a></li><li><a href="#babel-çš„-ast" class="table-of-contents__link">Babel çš„ AST</a></li><li><a href="#babelparser" class="table-of-contents__link"><code>@babel/parser</code></a></li><li><a href="#babeltraverse-æ ¸å¿ƒ" class="table-of-contents__link"><code>@babel/traverse</code> (æ ¸å¿ƒ)</a></li><li><a href="#babeltypes" class="table-of-contents__link"><code>@babel/types</code></a></li><li><a href="#babelgenerator" class="table-of-contents__link"><code>@babel/generator</code></a></li><li><a href="#babel-çš„å†…ç½®åŠŸèƒ½" class="table-of-contents__link">Babel çš„å†…ç½®åŠŸèƒ½</a></li><li><a href="#babel-æ’ä»¶å®æˆ˜---æ¸…é™¤-console-æºç " class="table-of-contents__link">Babel æ’ä»¶å®æˆ˜ - æ¸…é™¤ console æºç </a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">ç¬”è®°ğŸ“’</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_mu0C"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_mu0C"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_mu0C"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/physicshi" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_mu0C"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 wsgy, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.547ae20c.js"></script>
<script src="/assets/js/main.af06e908.js"></script>
</body>
</html>