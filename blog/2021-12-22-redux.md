---
slug: redux
title: 什么时候使用redux
authors: sgy
tags: [react, redux]
---

## 什么时候使用 redux

:::tip 前情提要
在前端发展初期，html 网页只是静态的，任何小的改动意味着一个新的页面；之后出现了 XMLHttpRequest，实现了异步的局部加载，极大的提升了用户体验；再到后面的 jQuery，利用命令式的编程直接操作 DOM，但应用一旦复杂的话也难以维护；

SPA 的出现进一步带动了前后端分离，前端再也不需要通过请求 URL 返回的 HTML 来显示页面，而是通过加载解析 JS 代码生成 DOM，独立地实现了内容的渲染，数据驱动的思想。

所谓数据驱动，是指视图是由数据驱动生成的，我们可以通过修改数据来处理 DOM，这也是典型的声明式编程。以 React 为例，我们可以轻松的通过改变 state 更新 UI，但是有一个问题，React 作为 UI 层，并不会对数据层有任何的限制，即任何组件都可以改变数据层，用户与组件进行交互就会改变数据，进而改变视图。

我们编写每一个组件的时候就已经在管理状态，框架会帮我们状态映射成视图。所以这里就有一个问题，如何管理视图组件的状态呢？衍生出了很多优秀的方案，Vuex, Redux 只是更方便我们进行 Global 的状态管理。

:::

在聊这个话题前，我想需要说一下为什么需要状态管理。

对于 SPA 应用来说，前端所需要管理的状态越来越多：

- 用户操作频繁，交互多，组件之间有状态依赖关系（比如 switch 控制其他组件的功能）-- UI 层复杂
- 客户端与服务端的交互，以登录为例，我们需要有未登录、登录成功、还需要 UI 元素展示中间状态、登录失败等状态

  - 但是这样的代码很难维护。搞个状态容器，将 if else 逻辑解耦来增加维护性。
    ```js
    var isRequestFinished, isInProgress, isSuccessful, isFailed;
    if (isInProgress) {
      // 请求过程中
    } else if (isRequestFinished) {
      if (isSuccessful) {
        // 展示请求成功信息
      } else if (isFailed) {
        // 展示请求失败信息和重试链接
      } else {
        // 展示欢迎信息和链接
      }
    } else {
      // 等待输入，展示表单
    }
    ```

- 前端数据缓存部分较多，比如记录用户对表单的提交前操作（包括数据回显）、分页控制 -- 业务逻辑

需要查询、更新、传递的状态也越来越多，这里很直观的会想到两个方案：

- 让每个组件去存储自身相关的状态（上述登录案例）
- 集中管理状态

对于第一种方案，理论上来讲不会影响应用的运行，但是很显然，在后续开发迭代中，会花费大量精力去监听、去更新、去维护每一个组件的状态。

这个时候，如果把状态集中管理，给到输入得到输出，我们不必关心派发到组件的细节，可以做到只关心业务逻辑。

> 严格来讲，storage 只是**数据存储**方式，其实跟状态管理其实没有太大关系，只是共享数据。

什么时候需要 redux 呢？

我觉得只要这点就够了：跨组件共享某些数据，状态树复杂。

> 但状态管理并不是必需品，当你的 UI 层比较简单、没有较多的交互去改变状态的场景下，使用状态管理方式反倒会让你的项目变的复杂。例如 Redux 的发明者 Dan Abramov 就说过这样一句话：“只有遇到 React 实在解决不了的问题，你才需要 Redux”。
> react 原生只支持父子、子父（或者在此基础上的兄弟组件通信），但是可以利用订阅发布处理“任意组件”之间的通信需求（监听事件的位置和触发事件的位置是不受限的，只要它们在同一个上下文里），不过这本身就是数据流的一种方案了。
